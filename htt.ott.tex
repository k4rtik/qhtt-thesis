% generated by Ott 0.31 from: htt.ott
\newcommand{\ottdrule}[4][]{{\displaystyle\frac{\begin{array}{l}#2\end{array}}{#3}\quad\ottdrulename{#4}}}
\newcommand{\ottusedrule}[1]{\[#1\]}
\newcommand{\ottpremise}[1]{ #1 \\}
\newenvironment{ottdefnblock}[3][]{ \framebox{\mbox{#2}} \quad #3 \\[0pt]}{}
\newenvironment{ottfundefnblock}[3][]{ \framebox{\mbox{#2}} \quad #3 \\[0pt]\begin{displaymath}\begin{array}{l}}{\end{array}\end{displaymath}}
\newcommand{\ottfunclause}[2]{ #1 \equiv #2 \\}
\newcommand{\ottnt}[1]{\mathit{#1}}
\newcommand{\ottmv}[1]{\mathit{#1}}
\newcommand{\ottkw}[1]{\mathbf{#1}}
\newcommand{\ottsym}[1]{#1}
\newcommand{\ottcom}[1]{\text{#1}}
\newcommand{\ottdrulename}[1]{\textsc{#1}}
\newcommand{\ottcomplu}[5]{\overline{#1}^{\,#2\in #3 #4 #5}}
\newcommand{\ottcompu}[3]{\overline{#1}^{\,#2<#3}}
\newcommand{\ottcomp}[2]{\overline{#1}^{\,#2}}
\newcommand{\ottgrammartabular}[1]{\begin{supertabular}{llcllllll}#1\end{supertabular}}
\newcommand{\ottmetavartabular}[1]{\begin{supertabular}{ll}#1\end{supertabular}}
\newcommand{\ottrulehead}[3]{$#1$ & & $#2$ & & & \multicolumn{2}{l}{#3}}
\newcommand{\ottprodline}[6]{& & $#1$ & $#2$ & $#3 #4$ & $#5$ & $#6$}
\newcommand{\ottfirstprodline}[6]{\ottprodline{#1}{#2}{#3}{#4}{#5}{#6}}
\newcommand{\ottlongprodline}[2]{& & $#1$ & \multicolumn{4}{l}{$#2$}}
\newcommand{\ottfirstlongprodline}[2]{\ottlongprodline{#1}{#2}}
\newcommand{\ottbindspecprodline}[6]{\ottprodline{#1}{#2}{#3}{#4}{#5}{#6}}
\newcommand{\ottprodnewline}{\\}
\newcommand{\ottinterrule}{\\[5.0mm]}
\newcommand{\ottafterlastrule}{\\}
\newcommand{\ottmetavars}{
\ottmetavartabular{
 $ \ottmv{termvar} ,\, \ottmv{x} $ &  \\
}}

\newcommand{\ottTyp}{
\ottrulehead{\ottnt{Typ}  ,\ \ottnt{A}  ,\ \ottnt{B}  ,\ \ottnt{C}}{::=}{\ottcom{Types}}\ottprodnewline
\ottfirstprodline{|}{\ottnt{K}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{bool}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{prop}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{unit}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{mono}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\Pi \, \ottmv{x}  \ottsym{:}  \ottnt{A}  \ottsym{.}  \ottnt{B}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{A}  \rightarrow  \ottnt{B}} {\textsf{S}}{}{}{}\ottprodnewline
\ottprodline{|}{\Sigma \, \ottmv{x}  \ottsym{:}  \ottnt{A}  \ottsym{.}  \ottnt{B}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{A} \, \times \, \ottnt{B}} {\textsf{S}}{}{}{}\ottprodnewline
\ottprodline{|}{\ottsym{\{}  \ottmv{x}  \ottsym{:}  \ottnt{A}  \ottsym{.}  \ottnt{P}  \ottsym{\}}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottsym{\{}  \ottnt{P}  \ottsym{\}}  \ottmv{x}  \ottsym{:}  \ottnt{A}  \ottsym{\{}  \ottnt{Q}  \ottsym{\}}}{}{}{}{}}

\newcommand{\ottElimTm}{
\ottrulehead{\ottnt{ElimTm}  ,\ \ottnt{K}  ,\ \ottnt{L}}{::=}{\ottcom{Elim Terms}}\ottprodnewline
\ottfirstprodline{|}{\ottmv{x}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{K} \, \ottnt{N}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{fst} \, \ottnt{K}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{snd} \, \ottnt{K}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{out} \, \ottnt{K}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{M}  \ottsym{:}  \ottnt{A}}{}{}{}{}}

\newcommand{\ottIntroTm}{
\ottrulehead{\ottnt{IntroTm}  ,\ \ottnt{M}  ,\ \ottnt{N}}{::=}{\ottcom{Intro Terms}}\ottprodnewline
\ottfirstprodline{|}{\ottnt{K}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{true}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{false}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottsym{()}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\lambda  \ottmv{x}  \ottsym{.}  \ottnt{M}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottsym{(}  \ottnt{M}  \ottsym{,}  \ottnt{N}  \ottsym{)}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{in} \, \ottnt{M}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{do} \, \ottnt{E}}{}{}{}{}}

\newcommand{\ottProp}{
\ottrulehead{\ottnt{Prop}  ,\ \ottnt{P}  ,\ \ottnt{Q}  ,\ \ottnt{R}}{::=}{\ottcom{Propositions (InTm)}}\ottprodnewline
\ottfirstprodline{|}{\top}{}{}{}{}\ottprodnewline
\ottprodline{|}{\bot}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{P}  \wedge  \ottnt{Q}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{P}  \vee  \ottnt{Q}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{P} \, \supset \, \ottnt{Q}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\neg \, \ottnt{P}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\forall \, \ottmv{x}  \ottsym{:}  \ottnt{A}  \ottsym{.}  \ottnt{P}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\exists \, \ottmv{x}  \ottsym{:}  \ottnt{A}  \ottsym{.}  \ottnt{P}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{xid} \, \ottsym{(}  \ottnt{A}  \ottsym{,}  \ottnt{B}  \ottsym{;}  \ottnt{M}  \ottsym{,}  \ottnt{N}  \ottsym{)}}{}{}{}{}}

\newcommand{\ottComm}{
\ottrulehead{\ottnt{Comm}  ,\ \ottnt{c}}{::=}{\ottcom{Commands}}\ottprodnewline
\ottfirstprodline{|}{\ottkw{init} \, \ottnt{M}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{apply} \, \ottnt{U} \, \ottkw{to} \, \ottnt{M}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{meas} \, \ottnt{M}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{if} \, \ottnt{M} \, \ottkw{then} \, \ottnt{E_{{\mathrm{1}}}} \, \ottkw{else} \, \ottnt{E_{{\mathrm{2}}}}}{}{}{}{}}

\newcommand{\ottUnitary}{
\ottrulehead{\ottnt{Unitary}  ,\ \ottnt{U}}{::=}{\ottcom{Unitaries}}\ottprodnewline
\ottfirstprodline{|}{\ottkw{I}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{X}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{Y}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{Z}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{H}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{S}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{CX}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{CZ}}{}{}{}{}}

\newcommand{\ottComp}{
\ottrulehead{\ottnt{Comp}  ,\ \ottnt{E}  ,\ \ottnt{F}}{::=}{\ottcom{Computations}}\ottprodnewline
\ottfirstprodline{|}{\ottkw{return} \, \ottnt{M}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{run} \, \ottmv{x}  \ottsym{=}  \ottnt{K} \, \ottkw{in} \, \ottnt{E}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottmv{x}  \ottsym{=}  \ottnt{c}  \ottsym{;}  \ottnt{E}}{}{}{}{}}

\newcommand{\ottMonoTyp}{
\ottrulehead{\ottnt{MonoTyp}  ,\ \tau  ,\ \sigma}{::=}{\ottcom{Monotypes (InTm)}}\ottprodnewline
\ottfirstprodline{|}{\ottkw{bool}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{prop}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottsym{()}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\Pi \, \ottmv{x}  \ottsym{:}  \tau  \ottsym{.}  \sigma}{}{}{}{}\ottprodnewline
\ottprodline{|}{\Sigma \, \ottmv{x}  \ottsym{:}  \tau  \ottsym{.}  \sigma}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottsym{\{}  \ottmv{x}  \ottsym{:}  \tau  \ottsym{.}  \ottnt{P}  \ottsym{\}}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottsym{\{}  \ottnt{P}  \ottsym{\}}  \sigma  \ottsym{:}  \tau  \ottsym{\{}  \ottnt{Q}  \ottsym{\}}}{}{}{}{}}

\newcommand{\ottDelta}{
\ottrulehead{\ottnt{Delta}  ,\ \Delta}{::=}{\ottcom{Contexts}}\ottprodnewline
\ottfirstprodline{|}{\ottsym{.}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\Delta  \ottsym{,}  \ottmv{x}  \ottsym{:}  \ottnt{A}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\Delta  \ottsym{,}  \ottnt{P}}{}{}{}{}}

\newcommand{\ottgrammar}{\ottgrammartabular{
\ottTyp\ottinterrule
\ottElimTm\ottinterrule
\ottIntroTm\ottinterrule
\ottProp\ottinterrule
\ottComm\ottinterrule
\ottUnitary\ottinterrule
\ottComp\ottinterrule
\ottMonoTyp\ottinterrule
\ottDelta\ottafterlastrule
}}

% defnss
% defns Jtype
%% defn ctx
\newcommand{\ottdrulectxEmpty}[1]{\ottdrule[#1]{%
}{
\vdash  \ottsym{.} \, \ottkw{ctx}}{%
{\ottdrulename{ctxEmpty}}{}%
}}


\newcommand{\ottdrulectxType}[1]{\ottdrule[#1]{%
\ottpremise{\vdash  \Delta \, \ottkw{ctx}}%
\ottpremise{\Delta  \vdash  \ottnt{A} \, \ottkw{type}}%
}{
\vdash  \Delta  \ottsym{,}  \ottmv{x}  \ottsym{:}  \ottnt{A} \, \ottkw{ctx}}{%
{\ottdrulename{ctxType}}{}%
}}


\newcommand{\ottdrulectxProp}[1]{\ottdrule[#1]{%
\ottpremise{\vdash  \Delta \, \ottkw{ctx}}%
\ottpremise{\Delta  \vdash  \ottnt{P} \, \textcolor{blue}{\stackrel{\leftarrow}{\in} } \, \ottkw{prop}}%
}{
\vdash  \Delta  \ottsym{,}  \ottnt{P} \, \ottkw{ctx}}{%
{\ottdrulename{ctxProp}}{}%
}}

\newcommand{\ottdefnctx}[1]{\begin{ottdefnblock}[#1]{$\vdash  \Delta \, \ottkw{ctx}$}{\ottcom{Checking contexts}}
\ottusedrule{\ottdrulectxEmpty{}}
\ottusedrule{\ottdrulectxType{}}
\ottusedrule{\ottdrulectxProp{}}
\end{ottdefnblock}}

%% defn Type
\newcommand{\ottdruletyElim}[1]{\ottdrule[#1]{%
\ottpremise{\Delta  \vdash  \ottnt{K} \, \textcolor{red}{\stackrel{\rightarrow}{\in} } \, \ottkw{mono}}%
}{
\Delta  \vdash  \ottnt{K} \, \ottkw{type}}{%
{\ottdrulename{tyElim}}{}%
}}


\newcommand{\ottdruletyBool}[1]{\ottdrule[#1]{%
}{
\Delta  \vdash  \ottkw{bool} \, \ottkw{type}}{%
{\ottdrulename{tyBool}}{}%
}}


\newcommand{\ottdruletyProp}[1]{\ottdrule[#1]{%
}{
\Delta  \vdash  \ottkw{prop} \, \ottkw{type}}{%
{\ottdrulename{tyProp}}{}%
}}


\newcommand{\ottdruletyMono}[1]{\ottdrule[#1]{%
}{
\Delta  \vdash  \ottkw{mono} \, \ottkw{type}}{%
{\ottdrulename{tyMono}}{}%
}}


\newcommand{\ottdruletyUnit}[1]{\ottdrule[#1]{%
}{
\Delta  \vdash  \ottkw{unit} \, \ottkw{type}}{%
{\ottdrulename{tyUnit}}{}%
}}


\newcommand{\ottdruletyPi}[1]{\ottdrule[#1]{%
\ottpremise{\Delta  \vdash  \ottnt{A} \, \ottkw{type}}%
\ottpremise{\Delta  \ottsym{,}  \ottmv{x}  \ottsym{:}  \ottnt{A}  \vdash  \ottnt{B} \, \ottkw{type}}%
}{
\Delta  \vdash  \Pi \, \ottmv{x}  \ottsym{:}  \ottnt{A}  \ottsym{.}  \ottnt{B} \, \ottkw{type}}{%
{\ottdrulename{tyPi}}{}%
}}


\newcommand{\ottdruletySig}[1]{\ottdrule[#1]{%
\ottpremise{\Delta  \vdash  \ottnt{A} \, \ottkw{type}}%
\ottpremise{\Delta  \ottsym{,}  \ottmv{x}  \ottsym{:}  \ottnt{A}  \vdash  \ottnt{B} \, \ottkw{type}}%
}{
\Delta  \vdash  \Sigma \, \ottmv{x}  \ottsym{:}  \ottnt{A}  \ottsym{.}  \ottnt{B} \, \ottkw{type}}{%
{\ottdrulename{tySig}}{}%
}}


\newcommand{\ottdruletyRefine}[1]{\ottdrule[#1]{%
\ottpremise{\Delta  \vdash  \ottnt{A} \, \ottkw{type}}%
\ottpremise{\Delta  \ottsym{,}  \ottmv{x}  \ottsym{:}  \ottnt{A}  \vdash  \ottnt{P} \, \textcolor{blue}{\stackrel{\leftarrow}{\in} } \, \ottkw{prop}}%
}{
\Delta  \vdash  \ottsym{\{}  \ottmv{x}  \ottsym{:}  \ottnt{A}  \ottsym{.}  \ottnt{P}  \ottsym{\}} \, \ottkw{type}}{%
{\ottdrulename{tyRefine}}{}%
}}

\newcommand{\ottdefnType}[1]{\begin{ottdefnblock}[#1]{$\Delta  \vdash  \ottnt{A} \, \ottkw{type}$}{\ottcom{$\ottnt{A}$ is a type}}
\ottusedrule{\ottdruletyElim{}}
\ottusedrule{\ottdruletyBool{}}
\ottusedrule{\ottdruletyProp{}}
\ottusedrule{\ottdruletyMono{}}
\ottusedrule{\ottdruletyUnit{}}
\ottusedrule{\ottdruletyPi{}}
\ottusedrule{\ottdruletySig{}}
\ottusedrule{\ottdruletyRefine{}}
\end{ottdefnblock}}

%% defn Term

\newcommand{\ottdefnTerm}[1]{\begin{ottdefnblock}[#1]{$\Delta  \vdash  \ottnt{M}  \ottsym{:}  \ottnt{A}$}{\ottcom{term $\ottnt{M}$ has type $\ottnt{A}$}}
\end{ottdefnblock}}

%% defn TyEq

\newcommand{\ottdefnTyEq}[1]{\begin{ottdefnblock}[#1]{$\ottnt{A}  \ottsym{=}  \ottnt{B}$}{\ottcom{$\ottnt{A}$ and $\ottnt{B}$ are equal as types}}
\end{ottdefnblock}}

%% defn TmEq

\newcommand{\ottdefnTmEq}[1]{\begin{ottdefnblock}[#1]{$\Delta  \vdash  \ottnt{M}  \ottsym{=}  \ottnt{N}  \ottsym{:}  \ottnt{A}$}{\ottcom{$\ottnt{M}$ and $\ottnt{N}$ are equal as terms of type $\ottnt{A}$}}
\end{ottdefnblock}}

%% defn Prop

\newcommand{\ottdefnProp}[1]{\begin{ottdefnblock}[#1]{$\Delta  \vdash  \ottnt{P} \, \textcolor{blue}{\stackrel{\leftarrow}{\in} } \, \ottkw{prop}$}{\ottcom{$\ottnt{P}$ type checks as a $\ottkw{prop}$}}
\end{ottdefnblock}}

%% defn TyIntro
\newcommand{\ottdruleTyInPi}[1]{\ottdrule[#1]{%
\ottpremise{\Delta  \ottsym{,}  \ottmv{x}  \ottsym{:}  \ottnt{A}  \vdash  \ottnt{M} \, \textcolor{blue}{\stackrel{\leftarrow}{\in} } \, \ottnt{B}}%
}{
\Delta  \vdash  \lambda  \ottmv{x}  \ottsym{.}  \ottnt{M} \, \textcolor{blue}{\stackrel{\leftarrow}{\in} } \, \Pi \, \ottmv{x}  \ottsym{:}  \ottnt{A}  \ottsym{.}  \ottnt{B}}{%
{\ottdrulename{TyInPi}}{}%
}}


\newcommand{\ottdruleTyInSig}[1]{\ottdrule[#1]{%
\ottpremise{\Delta  \vdash  \ottnt{M} \, \textcolor{blue}{\stackrel{\leftarrow}{\in} } \, \ottnt{A}}%
\ottpremise{\Delta  \vdash  \ottnt{N} \, \textcolor{blue}{\stackrel{\leftarrow}{\in} } \, \ottnt{B}  \ottsym{[}  \ottnt{M}  \ottsym{/}  \ottmv{x}  \ottsym{]}}%
}{
\Delta  \vdash  \ottsym{(}  \ottnt{M}  \ottsym{,}  \ottnt{N}  \ottsym{)} \, \textcolor{blue}{\stackrel{\leftarrow}{\in} } \, \Sigma \, \ottmv{x}  \ottsym{:}  \ottnt{A}  \ottsym{.}  \ottnt{B}}{%
{\ottdrulename{TyInSig}}{}%
}}


\newcommand{\ottdruleTyInRefine}[1]{\ottdrule[#1]{%
\ottpremise{\Delta  \vdash  \ottnt{M} \, \textcolor{blue}{\stackrel{\leftarrow}{\in} } \, \ottnt{A}}%
\ottpremise{\Delta  \models  \ottnt{P}  \ottsym{[}  \ottnt{M}  \ottsym{/}  \ottmv{x}  \ottsym{]}}%
}{
\Delta  \vdash  \ottkw{in} \, \ottnt{M} \, \textcolor{blue}{\stackrel{\leftarrow}{\in} } \, \ottsym{\{}  \ottmv{x}  \ottsym{:}  \ottnt{A}  \ottsym{.}  \ottnt{P}  \ottsym{\}}}{%
{\ottdrulename{TyInRefine}}{}%
}}


\newcommand{\ottdruleTyInElim}[1]{\ottdrule[#1]{%
\ottpremise{\Delta  \vdash  \ottnt{K} \, \textcolor{red}{\stackrel{\rightarrow}{\in} } \, \ottnt{A}}%
\ottpremise{\ottnt{A}  \ottsym{=}  \ottnt{B}}%
}{
\Delta  \vdash  \ottnt{K} \, \textcolor{blue}{\stackrel{\leftarrow}{\in} } \, \ottnt{B}}{%
{\ottdrulename{TyInElim}}{}%
}}

\newcommand{\ottdefnTyIntro}[1]{\begin{ottdefnblock}[#1]{$\Delta  \vdash  \ottnt{M} \, \textcolor{blue}{\stackrel{\leftarrow}{\in} } \, \ottnt{A}$}{\ottcom{$\ottnt{M}$ checks against type $\ottnt{A}$}}
\ottusedrule{\ottdruleTyInPi{}}
\ottusedrule{\ottdruleTyInSig{}}
\ottusedrule{\ottdruleTyInRefine{}}
\ottusedrule{\ottdruleTyInElim{}}
\end{ottdefnblock}}

%% defn TyElim
\newcommand{\ottdruleTyElPi}[1]{\ottdrule[#1]{%
\ottpremise{\Delta  \vdash  \ottnt{K} \, \textcolor{red}{\stackrel{\rightarrow}{\in} } \, \Pi \, \ottmv{x}  \ottsym{:}  \ottnt{A}  \ottsym{.}  \ottnt{B}}%
\ottpremise{\Delta  \vdash  \ottnt{M} \, \textcolor{blue}{\stackrel{\leftarrow}{\in} } \, \ottnt{A}}%
}{
\Delta  \vdash  \ottnt{K} \, \ottnt{M} \, \textcolor{red}{\stackrel{\rightarrow}{\in} } \, \ottnt{B}  \ottsym{[}  \ottnt{M}  \ottsym{/}  \ottmv{x}  \ottsym{]}}{%
{\ottdrulename{TyElPi}}{}%
}}


\newcommand{\ottdruleTyElFst}[1]{\ottdrule[#1]{%
\ottpremise{\Delta  \vdash  \ottnt{K} \, \textcolor{red}{\stackrel{\rightarrow}{\in} } \, \Sigma \, \ottmv{x}  \ottsym{:}  \ottnt{A}  \ottsym{.}  \ottnt{B}}%
}{
\Delta  \vdash  \ottkw{fst} \, \ottnt{K} \, \textcolor{red}{\stackrel{\rightarrow}{\in} } \, \ottnt{A}}{%
{\ottdrulename{TyElFst}}{}%
}}


\newcommand{\ottdruleTyElSnd}[1]{\ottdrule[#1]{%
\ottpremise{\Delta  \vdash  \ottnt{K} \, \textcolor{red}{\stackrel{\rightarrow}{\in} } \, \Sigma \, \ottmv{x}  \ottsym{:}  \ottnt{A}  \ottsym{.}  \ottnt{B}}%
}{
\Delta  \vdash  \ottkw{snd} \, \ottnt{K} \, \textcolor{red}{\stackrel{\rightarrow}{\in} } \, \ottnt{B}  \ottsym{[}  \ottkw{fst} \, \ottnt{K}  \ottsym{/}  \ottmv{x}  \ottsym{]}}{%
{\ottdrulename{TyElSnd}}{}%
}}


\newcommand{\ottdruleTyElRefine}[1]{\ottdrule[#1]{%
\ottpremise{\Delta  \vdash  \ottnt{K} \, \textcolor{red}{\stackrel{\rightarrow}{\in} } \, \ottsym{\{}  \ottmv{x}  \ottsym{:}  \ottnt{A}  \ottsym{.}  \ottnt{P}  \ottsym{\}}}%
}{
\Delta  \vdash  \ottkw{out} \, \ottnt{K} \, \textcolor{red}{\stackrel{\rightarrow}{\in} } \, \ottnt{A}}{%
{\ottdrulename{TyElRefine}}{}%
}}


\newcommand{\ottdruleTyElAscription}[1]{\ottdrule[#1]{%
\ottpremise{\Delta  \vdash  \ottnt{A} \, \ottkw{type}}%
\ottpremise{\Delta  \vdash  \ottnt{M} \, \textcolor{blue}{\stackrel{\leftarrow}{\in} } \, \ottnt{A}}%
}{
\Delta  \vdash  \ottnt{M}  \ottsym{:}  \ottnt{A} \, \textcolor{red}{\stackrel{\rightarrow}{\in} } \, \ottnt{A}}{%
{\ottdrulename{TyElAscription}}{}%
}}

\newcommand{\ottdefnTyElim}[1]{\begin{ottdefnblock}[#1]{$\Delta  \vdash  \ottnt{K} \, \textcolor{red}{\stackrel{\rightarrow}{\in} } \, \ottnt{A}$}{\ottcom{$\ottnt{K}$ synthesizes type $\ottnt{A}$}}
\ottusedrule{\ottdruleTyElPi{}}
\ottusedrule{\ottdruleTyElFst{}}
\ottusedrule{\ottdruleTyElSnd{}}
\ottusedrule{\ottdruleTyElRefine{}}
\ottusedrule{\ottdruleTyElAscription{}}
\end{ottdefnblock}}

%% defn Prove
\newcommand{\ottdrulePrRefine}[1]{\ottdrule[#1]{%
\ottpremise{\Delta  \vdash  \ottnt{K} \, \textcolor{red}{\stackrel{\rightarrow}{\in} } \, \ottsym{\{}  \ottmv{x}  \ottsym{:}  \ottnt{A}  \ottsym{.}  \ottnt{P}  \ottsym{\}}}%
}{
\Delta  \models  \ottnt{P}  \ottsym{[}  \ottkw{out} \, \ottnt{K}  \ottsym{/}  \ottmv{x}  \ottsym{]}}{%
{\ottdrulename{PrRefine}}{}%
}}

\newcommand{\ottdefnProve}[1]{\begin{ottdefnblock}[#1]{$\Delta  \models  \ottnt{P}$}{\ottcom{Proof obligation $\ottnt{P}$}}
\ottusedrule{\ottdrulePrRefine{}}
\end{ottdefnblock}}

%% defn CompIntro

\newcommand{\ottdefnCompIntro}[1]{\begin{ottdefnblock}[#1]{$\Delta  \ottsym{;}  \ottnt{P}  \vdash  \ottnt{E} \, \textcolor{blue}{\stackrel{\leftarrow}{\in} } \, \ottmv{x}  \ottsym{:}  \ottnt{A}  \ottsym{.}  \ottnt{Q}$}{\ottcom{With $\Delta, \ottnt{P}, \ottnt{A}$ check that $\ottnt{E}$ returns a value of type $\ottnt{A}$ with postcond. $\ottnt{Q}$}}
\end{ottdefnblock}}

%% defn CompElim

\newcommand{\ottdefnCompElim}[1]{\begin{ottdefnblock}[#1]{$\Delta  \ottsym{;}  \ottnt{P}  \vdash  \ottnt{E} \, \textcolor{red}{\stackrel{\rightarrow}{\in} } \, \ottmv{x}  \ottsym{:}  \ottnt{A}  \ottsym{.}  \ottnt{Q}$}{\ottcom{With $\Delta, \ottnt{P}, \ottnt{E}, \ottnt{A}$ as input, synthesize the strongest postcondition $\ottnt{Q}$}}
\end{ottdefnblock}}


\newcommand{\ottdefnsJtype}{
\ottdefnctx{}\ottdefnType{}\ottdefnTerm{}\ottdefnTyEq{}\ottdefnTmEq{}\ottdefnProp{}\ottdefnTyIntro{}\ottdefnTyElim{}\ottdefnProve{}\ottdefnCompIntro{}\ottdefnCompElim{}}

\newcommand{\ottdefnss}{
\ottdefnsJtype
}

\newcommand{\ottall}{\ottmetavars\\[0pt]
\ottgrammar\\[5.0mm]
\ottdefnss}

